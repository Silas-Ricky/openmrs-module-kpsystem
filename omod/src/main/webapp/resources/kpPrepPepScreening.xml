<!--

    This Source Code Form is subject to the terms of the Mozilla Public License,
    v. 2.0. If a copy of the MPL was not distributed with this file, You can
    obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under
    the terms of the Healthcare Disclaimer located at http://openmrs.org/license.

    Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS
    graphic logo is a trademark of OpenMRS Inc.

-->
<htmlform formUuid="a455aef4-56c8-4386-902e-b599c572f33f" formName="Prep/Pep Services Form"
          formEncounterType="b06625d4-dfe4-458c-93fa-e878c8370733" formVersion="1.0">

    <macros>
        screened_for=164082
        results=165047

        pep_use =164845
        prep_screening =165076

        exposure_type=165060
        prep_remarks=160632

        prep_eligible=165080
        prep_referred=1272
    </macros>

    <!-- Flowsheet table view -->
    <ifMode mode="VIEW" include="true">

        <table class="visit-table data-entry-table">
            <thead class="visit-table-header">
                <tr>
                    <td width="156" valign="top"><p>Visit date</p></td>
                    <td width="156" valign="top"><p>Screened for:</p></td>
                    <td width="156" valign="top"><p>Status</p></td>
                    <td width="156" valign="top"><p>Referred</p></td>
                    <td width="156" valign="top"><p>Using pep</p></td>
                    <td width="156" valign="top"><p>Exposure type</p></td>
                    <td width="156" valign="top"><p>Remarks</p></td>
                   </tr>
            </thead>
            <tbody class="visit-table-body">
                <tr class="visit-table-row">
                    <td class="nowrap visit-date">
                        <!-- Encounter Date -->
                        <encounterDate />
                    </td>
                    <td>
                        <!-- SCREENED-->
                        <obs conceptId="$screened_for" id="screening_for"
                             answerConceptIds="$pep_use,$prep_screening"
                             answerLabels="PEP,PREP"
                             style="dropdown" />
                    </td>
                    <td>
                        <!-- RESULTS -->
                        <obs conceptId="$results"
                             answerConceptIds="664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Negative,Positive"
                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- REFERRED -->
                        <obs conceptId="$prep_referred"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- PEP USAGE-->
                        <obs conceptId="$pep_use" id="pep_use"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- EXPOSURE TYPE -->
                        <obs conceptId="$exposure_type"
                             answerConceptIds="127910,165059, 160632"
                             answerLabels="Rape,Condom Burst,Others"
                             style="dropdown" />
                    </td>
                    <td>
                        <!-- REMARKS -->
                        <obs conceptId="$prep_remarks" />
                    </td>
                </tr>
            </tbody>
        </table>

    </ifMode>

    <!-- Data entry view -->
    <ifMode mode="VIEW" include="false">
        <table class="visit-edit-table">
            <tr>
                <th>Visit Date</th>
                <td><encounterDate id="visitDate" size="20" default="today" /></td>
            </tr>
            <tr>
                <th>Screened for:</th>
                <td>    <obs conceptId="$screened_for" id="screening_for"
                             answerConceptIds="$pep_use,$prep_screening"
                             answerLabels="PEP,PREP"
                             style="dropdown" />
                </td>
            </tr>
            <tr>
                <th>Status</th>
                <td>  <obs conceptId="$results" id="status"
                           answerConceptIds="664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                           answerLabels="Negative,Positive"
                           style="dropdown"/>
                </td>
            </tr>
            <tr>
                <th>Referred</th>
                <td>
                    <obs conceptId="$prep_referred" id="referred"
                         answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                         answerLabel="Yes,No"
                         style="dropdown"/>
                </td>
            </tr>
            <tr>
                <th>Using Pep</th>
                <td>   <obs conceptId="$pep_use" id="pep_use"
                            answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                            answerLabel="Yes,No"
                            style="dropdown"/>
                </td>
            </tr>
            <tr>
                <th>Exposure type</th>
                <td>  <obs conceptId="$exposure_type" id="exposure_type"
                           answerConceptIds="127910,165059, 160632"
                           answerLabels="Rape,Condom Burst,Others"
                           style="dropdown" />
                </td>
            </tr>
            <tr>
                <th>Remarks</th>
                <td><obs conceptId="$prep_remarks" id="remarks_input" /></td>
            </tr>
        </table>
        <submit/>
    </ifMode>
    <script type="text/javascript">
        jq(function() {

        var screeningType = jq("#flowsheet-edit-section-0").find("#screening_for select").change(screeningReasonSelected)

       console.log("Run  ==> screeningReasonSelected");
        screeningReasonSelected();

        });

        function screeningReasonSelected() {

        var screening_type = jq("#flowsheet-edit-section-0").find("#screening_for select").val();


        console.log("Screened for ==> "+screening_type);
        if (screening_type == $prep_screening){
                jq('#pep_use select').prop('disabled', true);
                jq('#exposure_type select').prop('disabled', true);
                jq('#status select').prop('disabled', false);
                jq('#referred select').prop('disabled', false);

        }else if (screening_type == $pep_use){
                jq('#pep_use select').prop('disabled', false);
                jq('#exposure_type select').prop('disabled', false);
                jq('#status select').prop('disabled', true);
                jq('#referred select').prop('disabled', true);
        }else{
                jq('#pep_use select').prop('disabled', true);
                jq('#exposure_type select').prop('disabled', true);
                jq('#status select').prop('disabled', true);
                jq('#referred select').prop('disabled', true);

           }
        }

    </script>
</htmlform>