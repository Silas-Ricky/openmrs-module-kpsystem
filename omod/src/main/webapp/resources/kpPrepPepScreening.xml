<!--

    This Source Code Form is subject to the terms of the Mozilla Public License,
    v. 2.0. If a copy of the MPL was not distributed with this file, You can
    obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under
    the terms of the Healthcare Disclaimer located at http://openmrs.org/license.

    Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS
    graphic logo is a trademark of OpenMRS Inc.

-->
<htmlform formUuid="a455aef4-56c8-4386-902e-b599c572f33f" formName="Prep/Pep Services Form"
          formEncounterType="b06625d4-dfe4-458c-93fa-e878c8370733" formVersion="1.0">

    <macros>
        screened_for=164082
        results=165047
        facility_name=162724


        pep_use =164845
        prep_screening =165076

        exposure_type=165060
        prep_remarks=160632

        prep_eligible=165080
        prep_referred=1272
    </macros>

    <!-- Flowsheet table view -->
    <ifMode mode="VIEW" include="true">

        <table class="visit-table data-entry-table">
            <thead class="visit-table-header">
                <tr>
                    <td width="156" valign="top"><p>Visit date</p></td>
                    <td width="156" valign="top"><p>Screened for:</p></td>
                    <td width="156" valign="top"><p>Results</p></td>

                    <td width="156" valign="top"><p>Status</p></td>
                    <td width="156" valign="top"><p>Referred</p></td>
                    <td width="156" valign="top"><p>Using pep</p></td>
                    <td width="156" valign="top"><p>Exposure type</p></td>
                    <td width="156" valign="top"><p>Remarks</p></td>
                </tr>
            </thead>
            <tbody class="visit-table-body">
                <tr class="visit-table-row">
                    <td class="nowrap visit-date">
                        <!-- Encounter Date -->
                        <encounterDate />
                    </td>
                    <td>
                        <!-- SCREENED-->
                        <obs conceptId="$screened_for" id="screening_for"
                             answerConceptIds="$pep_use,$prep_screening"
                             answerLabels="PEP,PREP"
                             style="dropdown" />
                    </td>

                    <td>
                        <!-- RESULTS -->
                        <obs conceptId="$results"
                             answerConceptIds="165087,165078"

                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- STATUS -->
                        <obs conceptId="165102"
                             answerConceptIds="1065,1066"
                             answerLabels="Prep initiated,Prep not initiated"
                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- REFERRED -->
                        <obs conceptId="$prep_referred"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- PEP USAGE-->
                        <obs conceptId="$pep_use" id="pep_use"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Yes,No"
                             style="dropdown"/>
                    </td>
                    <td>
                        <!-- EXPOSURE TYPE -->
                        <obs conceptId="$exposure_type"
                             answerConceptIds="127910,165059, 160632"
                             answerLabels="Rape,Condom Burst,Others"
                             style="dropdown" />
                    </td>
                    <td>
                        <!-- REMARKS -->
                        <obs conceptId="$prep_remarks" />
                    </td>
                </tr>
            </tbody>
        </table>

    </ifMode>

    <!-- Data entry view -->
    <ifMode mode="VIEW" include="false">
        <table class="visit-edit-table">
            <tr>
                <th>Visit Date</th>
                <td><encounterDate id="visitDate" size="20" default="today" /></td>
            </tr>
            <tr>
                <th>Screened for:</th>
                <td>    <obs conceptId="$screened_for" id="screening_for"
                             answerConceptIds="$pep_use,$prep_screening"
                             answerLabels="PEP,PREP"
                             style="dropdown" />
                </td>
            </tr>
            <tr>
                <th>Results</th>
                <td>  <obs conceptId="$results" id="results"
                           answerConceptIds="165087,165078"
                           style="dropdown"/>
                </td>
            </tr>
            <tr>
                <th>Status</th>
                <td>  <obs conceptId="165102" id="status"
                           answerConceptIds="1065,1066"
                           answerLabels="Prep initiated,Prep not initiated"
                           style="dropdown"/>
                </td>
            </tr>
            <tr>
                <th>Referred</th>
                <td>
                    <obs conceptId="$prep_referred" id="referred"
                         answerConceptIds="1065,1066"
                         answerLabel="Yes,No"
                         style="dropdown"/>
                </td>
            </tr>

            <tr>
                <th>Facility Name</th>

                <td><obs id="facility_name" conceptId="$facility_name"  /> </td>

            </tr>
            <tr>
                <th>Using Pep</th>
                <td>   <obs conceptId="$pep_use" id="pep_use"
                            answerConceptIds="1065,1066"
                            answerLabel="Yes,No"
                            style="dropdown"/>
                </td>
            </tr>
            <tr>
                <th>Exposure type</th>
                <td>  <obs conceptId="$exposure_type" id="exposure_type"
                           answerConceptIds="127910,165059, 160632"
                           answerLabels="Rape,Condom Burst,Others"
                           style="dropdown" />
                </td>
            </tr>
            <tr>
                <th>Specify</th>
                <td><obs conceptId="$prep_remarks" id="remarks_input" /></td>
            </tr>
        </table>
        <submit/>
    </ifMode>

    <script type="text/javascript">
        jq(function() {

        jq('#remarks_input input').prop('disabled', true).addClass('disabled');
        jq('#facility_name input').prop('disabled', true).addClass('disabled');
        jq('#pep_use select').prop('disabled', false).removeClass('disabled');
        jq('#status select').prop('disabled', true).addClass('disabled');
        jq('#results select').prop('disabled', true).addClass('disabled');
        jq('#referred select').prop('disabled', true).addClass('disabled');
        jq('#pep_use select').prop('disabled', true).addClass('disabled');
        jq('#exposure_type select').prop('disabled', true).addClass('disabled');

        var screeningType = jq("#screening_for select").change(screeningReasonSelected)
        var referred = jq("#referred select").change(RefferedTo)
        var exposureType = jq("#exposure_type select").change(ExposureType)



        });

        function RefferedTo() {
        var refferedto = jq("#referred select").val();

        console.log("Screened for ==> "+refferedto);
        if (refferedto == 1065){

        jq('#facility_name input').prop('disabled', false).removeClass('disabled');
        }else
        {
        jq('#facility_name input').prop('disabled', true).addClass('disabled');

        }

        }


        function ExposureType() {
        var exposure = jq("#exposure_type select").val();


        console.log("Screened for ==> "+exposure);
        if (exposure == 160632){
        jq('#remarks_input input').prop('disabled', false).removeClass('disabled');
        }else
        {
        jq('#remarks_input input').prop('disabled', true).addClass('disabled');
        }
        }

        function screeningReasonSelected() {
        var screening_type = jq("#screening_for select").val();


        console.log("Screened for ==> "+screening_type);
        if (screening_type == $prep_screening){

        jq('#pep_use select').prop('disabled', true).addClass('disabled');

        jq('#pep_use select').val('');
        jq('#exposure_type select').prop('disabled', true).addClass('disabled');
        jq('#exposure_type select').val('');
        jq('#status select').prop('disabled', false).removeClass('disabled');
        jq('#results select').prop('disabled', false).removeClass('disabled');
        jq('#referred select').prop('disabled', false).removeClass('disabled');

        }else if (screening_type == $pep_use){
        jq('#facility_name input').prop('disabled', true).addClass('disabled');
        jq('#pep_use select').prop('disabled', false).removeClass('disabled');
        jq('#exposure_type select').prop('disabled', false).removeClass('disabled');
        jq('#status select').prop('disabled', true).addClass('disabled');
        jq('#status select').val('');
        jq('#results select').prop('disabled', true).addClass('disabled');
        jq('#results select').val('');
        jq('#referred select').prop('disabled', true).addClass('disabled');
        jq('#referred select').val('');

        }

        }

    </script>


</htmlform>